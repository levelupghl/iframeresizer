{"version":3,"file":"iframeResizer.js","sources":["../../src/js/lib/debounce.ts","../../src/js/iframeResizer.ts"],"sourcesContent":["export function debounce(func: () => void, wait: number): () => void {\n  let timeout: number | undefined\n  return function executedFunction(): void {\n    const later = (): void => {\n      clearTimeout(timeout)\n      func()\n    }\n    clearTimeout(timeout)\n    timeout = window.setTimeout(later, wait)\n  }\n}\n","// TODO: figure out how to only include js/iframeResizer in rollup build\n//  Tried excluding *.contentWindow.js but it didn't work\n// import iframeResize from \"iframe-resizer/js/iframeResizer\"\n\nimport { iframeResizer } from \"iframe-resizer\"\nimport { debounce } from \"./lib/debounce\"\n\nexport interface CustomWindow extends Window {\n  levelup: {\n    iframe: any\n  }\n}\ndeclare let window: CustomWindow\n\ninterface ScriptElem extends HTMLScriptElement {\n  dataset: {\n    iframeSelector: string\n  }\n}\ninterface IframeElem extends HTMLElement {\n  dataset: {\n    resizeInit: string\n  }\n}\n\nconst observe = (selector: string) => {\n  const config = {\n    attributes: true,\n    attributeOldValue: false,\n    characterData: true,\n    characterDataOldValue: false,\n    childList: true,\n    subtree: true,\n  }\n  const observer = new MutationObserver(\n    debounce(() => {\n      document.querySelectorAll<IframeElem>(selector).forEach((iframe) => {\n        if (!iframe.dataset.resizeInit) {\n          iframe.dataset.resizeInit = \"true\"\n          resizer({ autoResize: true }, iframe)\n        }\n      })\n    }, 50)\n  )\n  observer.observe(document.body, config)\n}\n\nconst loading = (iframe: HTMLElement): HTMLElement | void => {\n  const loaderDiv: HTMLDivElement = document.createElement(\"div\")\n  loaderDiv.classList.add(\"iframeLoading\")\n  loaderDiv.innerHTML = `<div style=\"width:24px;margin:20px auto 0\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><style>.spinner_ajPY{transform-origin:center;animation:spinner_AtaB .75s infinite linear}@keyframes spinner_AtaB{100%{transform:rotate(360deg)}}</style><path d=\"M12,1A11,11,0,1,0,23,12,11,11,0,0,0,12,1Zm0,19a8,8,0,1,1,8-8A8,8,0,0,1,12,20Z\" opacity=\".25\"/><path d=\"M10.14,1.16a11,11,0,0,0-9,8.92A1.59,1.59,0,0,0,2.46,12,1.52,1.52,0,0,0,4.11,10.7a8,8,0,0,1,6.66-6.61A1.42,1.42,0,0,0,12,2.69h0A1.57,1.57,0,0,0,10.14,1.16Z\" class=\"spinner_ajPY\"/></svg></div>`\n  iframe.parentNode?.insertBefore(loaderDiv, iframe)\n  iframe.addEventListener(\"load\", function () {\n    doneLoading(loaderDiv)\n  })\n  return loaderDiv\n}\n\nconst doneLoading = (loaderDiv: HTMLElement) => {\n  loaderDiv.style.display = \"none\"\n}\n\nconst resizer = (options: any, elem: HTMLElement | string) => {\n  const iframe =\n    typeof elem === \"string\"\n      ? (document.querySelector(elem) as HTMLElement)\n      : elem\n  const loaderDiv = loading(iframe)\n  options.onInit = options.onResized = (el: HTMLElement) => {\n    if (loaderDiv) {\n      doneLoading(loaderDiv)\n    }\n  }\n  // For Embed Notion Pages\n  // TODO: detect embednotionpage.com src url?\n  debugger\n  // bodyOffset' | 'bodyScroll' | 'documentElementOffset' | 'documentElementScroll' |\n  // ;\"max\" | \"min\" | \"grow\" | \"lowestElement\" | \"taggedElement\"\n  options.heightCalculationMethod = \"taggedElement\"\n  iframeResizer(options, iframe)\n}\n\nconst run = () => {\n  // Check if iframe selector was provided on the script tag and queue is empty\n  const script = document.currentScript as ScriptElem\n  if (script?.dataset?.iframeSelector) {\n    // Observe for any iframes that match the selector\n    observe(script.dataset.iframeSelector)\n  }\n\n  const queue = window.levelup?.iframe?.queue\n  if (!queue) {\n    return\n  }\n\n  while (queue.length) {\n    const args = queue.shift()\n    const [options, iframe] = args\n    resizer(options, iframe)\n  }\n  // Now that the queue is cleared, override the global constructor\n  window.levelup.iframe = iframeResizer\n}\n\nconst init = () => {\n  // Wait for document to load\n  if (\n    document.readyState === \"complete\" ||\n    document.readyState === \"interactive\"\n  ) {\n    run()\n  } else {\n    document.addEventListener(\"DOMContentLoaded\", () => {\n      run()\n    })\n  }\n}\n\nconsole.log(`Powered by __theme_name__ __theme_version__:`, \"__theme_website__\")\n\ninit()\n"],"names":["iframeResizer"],"mappings":"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"}