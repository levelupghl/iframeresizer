{"version":3,"file":"iframeResizer.min.js","sources":["../../src/js/lib/debounce.ts","../../src/js/iframeResizer.ts"],"sourcesContent":["export function debounce(func: () => void, wait: number): () => void {\n  let timeout: number | undefined\n  return function executedFunction(): void {\n    const later = (): void => {\n      clearTimeout(timeout)\n      func()\n    }\n    clearTimeout(timeout)\n    timeout = window.setTimeout(later, wait)\n  }\n}\n","// TODO: figure out how to only include js/iframeResizer in rollup build\n//  Tried excluding *.contentWindow.js but it didn't work\n// import iframeResize from \"iframe-resizer/js/iframeResizer\"\n\nimport { iframeResizer } from \"iframe-resizer\"\nimport { debounce } from \"./lib/debounce\"\n\nexport interface CustomWindow extends Window {\n  levelup: {\n    iframe: any\n  }\n}\ndeclare let window: CustomWindow\n\ninterface ScriptElem extends HTMLScriptElement {\n  dataset: {\n    iframeSelector: string\n  }\n}\ninterface IframeElem extends HTMLElement {\n  dataset: {\n    resizeInit: string\n  }\n}\n\nconst observe = (selector: string) => {\n  const config = {\n    attributes: true,\n    attributeOldValue: false,\n    characterData: true,\n    characterDataOldValue: false,\n    childList: true,\n    subtree: true,\n  }\n  const observer = new MutationObserver(\n    debounce(() => {\n      document.querySelectorAll<IframeElem>(selector).forEach((iframe) => {\n        if (!iframe.dataset.resizeInit) {\n          iframe.dataset.resizeInit = \"true\"\n          resizer({ autoResize: true }, iframe)\n        }\n      })\n    }, 50)\n  )\n  observer.observe(document.body, config)\n}\n\nconst loading = (iframe: HTMLElement): HTMLElement | void => {\n  const loaderDiv: HTMLDivElement = document.createElement(\"div\")\n  loaderDiv.classList.add(\"iframeLoading\")\n  loaderDiv.innerHTML = `<div style=\"width:24px;margin:20px auto 0\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><style>.spinner_ajPY{transform-origin:center;animation:spinner_AtaB .75s infinite linear}@keyframes spinner_AtaB{100%{transform:rotate(360deg)}}</style><path d=\"M12,1A11,11,0,1,0,23,12,11,11,0,0,0,12,1Zm0,19a8,8,0,1,1,8-8A8,8,0,0,1,12,20Z\" opacity=\".25\"/><path d=\"M10.14,1.16a11,11,0,0,0-9,8.92A1.59,1.59,0,0,0,2.46,12,1.52,1.52,0,0,0,4.11,10.7a8,8,0,0,1,6.66-6.61A1.42,1.42,0,0,0,12,2.69h0A1.57,1.57,0,0,0,10.14,1.16Z\" class=\"spinner_ajPY\"/></svg></div>`\n  iframe.parentNode?.insertBefore(loaderDiv, iframe)\n  iframe.addEventListener(\"load\", function () {\n    doneLoading(loaderDiv)\n  })\n  return loaderDiv\n}\n\nconst doneLoading = (loaderDiv: HTMLElement) => {\n  loaderDiv.style.display = \"none\"\n}\n\nconst resizer = (options: any, elem: HTMLElement | string) => {\n  const iframe =\n    typeof elem === \"string\"\n      ? (document.querySelector(elem) as HTMLElement)\n      : elem\n  const loaderDiv = loading(iframe)\n  options.onInit = options.onResized = (el: HTMLElement) => {\n    if (loaderDiv) {\n      doneLoading(loaderDiv)\n    }\n  }\n  // For Embed Notion Pages\n  // TODO: detect embednotionpage.com src url?\n  debugger\n  // bodyOffset' | 'bodyScroll' | 'documentElementOffset' | 'documentElementScroll' |\n  // ;\"max\" | \"min\" | \"grow\" | \"lowestElement\" | \"taggedElement\"\n  options.heightCalculationMethod = \"taggedElement\"\n  iframeResizer(options, iframe)\n}\n\nconst run = () => {\n  // Check if iframe selector was provided on the script tag and queue is empty\n  const script = document.currentScript as ScriptElem\n  if (script?.dataset?.iframeSelector) {\n    // Observe for any iframes that match the selector\n    observe(script.dataset.iframeSelector)\n  }\n\n  const queue = window.levelup?.iframe?.queue\n  if (!queue) {\n    return\n  }\n\n  while (queue.length) {\n    const args = queue.shift()\n    const [options, iframe] = args\n    resizer(options, iframe)\n  }\n  // Now that the queue is cleared, override the global constructor\n  window.levelup.iframe = iframeResizer\n}\n\nconst init = () => {\n  // Wait for document to load\n  if (\n    document.readyState === \"complete\" ||\n    document.readyState === \"interactive\"\n  ) {\n    run()\n  } else {\n    document.addEventListener(\"DOMContentLoaded\", () => {\n      run()\n    })\n  }\n}\n\nconsole.log(`Powered by __theme_name__ __theme_version__:`, \"__theme_website__\")\n\ninit()\n"],"names":["debounce","func","wait","timeout","later","observe","selector","config","iframe","resizer","loading","_a","loaderDiv","doneLoading","options","elem","el","iframeResizer","run","_b","_c","script","queue","args","init"],"mappings":";;;;oEAAO,SAASA,EAASC,EAAkBC,EAA0B,CACnE,IAAIC,EACJ,OAAO,UAAkC,CACvC,MAAMC,EAAQ,IAAY,CACxB,aAAaD,CAAO,EACpBF,EACF,CAAA,EACA,aAAaE,CAAO,EACpBA,EAAU,OAAO,WAAWC,EAAOF,CAAI,CACzC,CACF,CCeA,MAAMG,EAAWC,GAAqB,CACpC,MAAMC,EAAS,CACb,WAAY,GACZ,kBAAmB,GACnB,cAAe,GACf,sBAAuB,GACvB,UAAW,GACX,QAAS,EACX,EACiB,IAAI,iBACnBP,EAAS,IAAM,CACb,SAAS,iBAA6BM,CAAQ,EAAE,QAASE,GAAW,CAC7DA,EAAO,QAAQ,aAClBA,EAAO,QAAQ,WAAa,OAC5BC,EAAQ,CAAE,WAAY,EAAK,EAAGD,CAAM,EAExC,CAAC,CACH,EAAG,EAAE,CACP,EACS,QAAQ,SAAS,KAAMD,CAAM,CACxC,EAEMG,EAAWF,GAA4C,CA/C7D,IAAAG,EAgDE,MAAMC,EAA4B,SAAS,cAAc,KAAK,EAC9D,OAAAA,EAAU,UAAU,IAAI,eAAe,EACvCA,EAAU,UAAY,wkBACtBD,EAAAH,EAAO,aAAP,MAAAG,EAAmB,aAAaC,EAAWJ,CAC3CA,EAAAA,EAAO,iBAAiB,OAAQ,UAAY,CAC1CK,EAAYD,CAAS,CACvB,CAAC,EACMA,CACT,EAEMC,EAAeD,GAA2B,CAC9CA,EAAU,MAAM,QAAU,MAC5B,EAEMH,EAAU,CAACK,EAAcC,IAA+B,CAC5D,MAAMP,EACJ,OAAOO,GAAS,SACX,SAAS,cAAcA,CAAI,EAC5BA,EACAH,EAAYF,EAAQF,CAAM,EAChCM,EAAQ,OAASA,EAAQ,UAAaE,GAAoB,CACpDJ,GACFC,EAAYD,CAAS,CAEzB,EAGA,SAGAE,EAAQ,wBAA0B,gBAClCG,EAAAA,cAAcH,EAASN,CAAM,CAC/B,EAEMU,EAAM,IAAM,CAlFlB,IAAAP,EAAAQ,EAAAC,EAoFE,MAAMC,EAAS,SAAS,eACpBV,EAAAU,GAAA,KAAAA,OAAAA,EAAQ,UAAR,MAAAV,EAAiB,gBAEnBN,EAAQgB,EAAO,QAAQ,cAAc,EAGvC,MAAMC,GAAQF,GAAAD,EAAA,OAAO,UAAP,KAAAA,OAAAA,EAAgB,SAAhB,KAAA,OAAAC,EAAwB,MACtC,GAAKE,EAIL,CAAOA,KAAAA,EAAM,QAAQ,CACnB,MAAMC,EAAOD,EAAM,MAAM,EACnB,CAACR,EAASN,CAAM,EAAIe,EAC1Bd,EAAQK,EAASN,CAAM,CACzB,CAEA,OAAO,QAAQ,OAASS,EAC1B,aAAA,CAAA,EAEMO,EAAO,IAAM,CAGf,SAAS,aAAe,YACxB,SAAS,aAAe,cAExBN,EAAAA,EAEA,SAAS,iBAAiB,mBAAoB,IAAM,CAClDA,EAAI,CACN,CAAC,CAEL,EAEA,QAAQ,IAAI,6CAAgD,2BAAmB,EAE/EM,EAAK"}